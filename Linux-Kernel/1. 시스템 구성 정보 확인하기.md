## 1. 커널 정보 확인하기

시스템 트러블슈팅의 첫걸음은 현재 시스템 환경을 정확히 파악하는 것이다.

### **1.1 커널 버전 및 기본 정보 (`uname`)**

![](images/Pasted%20image%2020260126232233.png)
- **명령어:** `uname -a`
- 커널 버전, 호스트 이름, 아키텍처(x86_64 등), OS 종류를 한눈에 확인할 수 있다.
- 해당 서버의 커널 버전: `6.1.159-182.297.amzn2023.x86_64` - x86계열의 64비트 운영체제 사용
    
### **1.2 부팅 파라미터 및 디버그 메시지 (`dmesg`, `/proc/cmdline`)**

- **dmesg:** 커널의 디버그 메시지로, 커널 부팅 시 출력되는 메시지와 하드웨어 인식 과정, 드라이버 로딩 정보, 커널 파라미터 등을 확인 가능하다.
	- ![](images/Pasted%20image%2020260126232941.png)
		- 책의 예제는 물리 서버기준이지만
		- `Booting paravirtualized kernel on Xen HVM`: EC2 인스턴스가 Xen 하이퍼바이저 위에서 가상 머신(HVM, Hardware Virtual Machine)으로 동작하고 있음을 의미
		- `nvme_core.io_timeout`: 클라우드 스토리지 최적화
			- 물리 서버의 SSD는 본체에 직접 연결되어 있지만, EC2의 EBS는 네트워크를 통해 연결된 원격 저장소
			- 커널의 기본 타임아웃이 너무 짧으면, 네트워크의 일시적인 순단에도 커널은 디스크 장애로 판단할 수 있음
			- `nvme_core.io_timeout=4294967295` 값은 16진수로 `0xFFFFFFFF`이며, 이는 사실상 **무한 대기**를 의미
			- AWS는 EBS의 가용성을 보장하기 위해, 짧은 시간 내에 에러를 내고 포기하는 대신 끝까지 입출력(I/O)을 완료하도록 유도
    
    - 커널 파라미터
	    - `intel_idle.max_cstate=0`: CPU의 전력 절감 모드(C-State)를 제한하여 성능 저하를 방지하는 설정
		    - C-State: 특별한 작업 없는 idle 상태가 되면 일부 CPU 코어를 잠자기 모드로 전환
		    - 급격한 트래픽 증가에서는 잠자기 모드인 코어를 다시 가동시켜야하기 때문에 성능저하가 발생할 수 있어 경우에 따라 C-State를 꺼야한다.
	    - `crashkernel`: 커널 패닉 발생 시 덤프를 생성하기 위해 미리 예약된 메모리 영역
		    - 패닉 상태 빠졌을때 crashkernel을 로딩해서 패닉에 빠진 커널의 디버깅 정보를 저장한다. 이로써커널에 어떤 문제가 발생했는지 추적가능하다
        
- **/proc/cmdline:** 부팅 시 적용된 커널 파라미터 확인 가능. 
	- ![](images/Pasted%20image%2020260126234209.png)
-  **`/proc` 파일 시스템의 실시간성**
	- `/proc`은 하드디스크에 저장된 파일이 아니라, 커널의 정보를 보여주는 **가상 파일 시스템**
	- 파일을 읽는 순간 커널 내부 메모리에서 정보를 가져오기 때문에 항상 최신 상태임을 인지하는 것이 중요
    

### **1.3 커널 컴파일 옵션 확인**

- **명령어:** `cat /boot/config-$(uname -r)`
    
- **이유:** 
	- 커널의 기능 중 컴파일 옵션에 포함되어야만 사용할 수 있는 기능들이 존재하기 때문
	- 예. 특정 기능(예: ftrace의 `CONFIG_FUNCTION_TRACER`)이 커널에 포함되어 컴파일되었는지 확인하기 위함
- ![](images/Pasted%20image%2020260126234515.png)
	
    

---

## 2. CPU 정보 확인하기 (`dmidecode`)

`dmidecode`는 BIOS(DMI) 테이블에서 하드웨어 정보를 읽어오는 도구로, 총 9가지 키워드를 사용할 수 있다. (man 명령을 통해 확인 가능)

| **키워드**       | **확인 가능한 정보**                     |
| ------------- | --------------------------------- |
| **bios**      | BIOS 제조사, 버전, 릴리스 날짜              |
| **system**    | 장비 제조사(HP, Dell 등), 모델명, 시리얼 번호   |
| **processor** | CPU 소켓 수, 모델명, 코어 수, 스레드 수, 전압    |
| **memory**    | 메모리 슬롯 정보, 최대 지원 용량, 개별 메모리 크기/속도 |
- bios 
	- ![](images/Pasted%20image%2020260126235052.png)
	- bios 키워드는 특정 BIOS 버전의 버그 여부를 확인하기 위해 사용
	- 책 예시. HP 서버 예시에서 BIOS 발행일(2015/08/16)과 펌웨어 버전(1.85) 등을 확인
- system
	- dmidecode 중에 가장 많이 사용
	- 제조사, 제품명, 시리얼 번호 등 장비의 정체성을 확인하는 데 가장 많이 사용
	- ![](images/Pasted%20image%2020260126235224.png)
- processor
	- ![](images/Pasted%20image%2020260126235522.png)
	- 책: 커널이 메인보드의 BIOS로부터 물리적인 CPU 다이(Die) 정보를 직접 읽어올 수 있지만,
	- **현재 환경 (EC2):** AWS의 하이퍼바이저(Nitro 또는 Xen)가 하드웨어 정보를 추상화하여 전달/ 보안 및 자원 관리 효율성을 위해 하이퍼바이저는 실제 물리 CPU의 세세한 명세(Core Count 등)를 DMI 테이블에 모두 채워 넣지 않고 `Not Specified`나 `Other`로 표시하는 경우가 많음.

---

## 3. CPU 및 메모리 상세 분석

### **3.1 CPU 정보 (`lscpu`, `/proc/cpuinfo`)**

- **물리 소켓(Socket):** 메인보드에 장착된 실제 CPU 개수, 물리적인 CPU 개수
- **코어(Core):** 하나의 CPU 안에 들어있는 물리적인 연산 단위
	- 소켓 2개에 각 6개의 코어가 존재한다고 할때
		- 하이퍼스레딩 기술을 통해 각각의 코어가 멀티로 동작하여 총 12개 코어 사용 가능 
- **스레드(Thread):** 하이퍼스레딩 기술을 통해 논리적으로 보이는 연산 단위


-  `/proc/cpuinfo`
	- ![](images/Pasted%20image%2020260126235937.png)
- **lscpu:** NUMA 노드 정보와 캐시 사이즈를 포함하여 요약된 정보를 보여준다.
	- ![](images/Pasted%20image%2020260127000103.png)
	- 해당 케이스에서는 소켓 1, 코어 1
- memory
	- ![](images/Pasted%20image%2020260127000303.png)
	- ![](images/Pasted%20image%2020260127001243.png)
	- `Physical Memory Array`를 통해 최대 꽂을 수 있는 용량과 슬롯 수를 확인하고, `Memory Device`로 실제 꽂힌 메모리의 용량과 제조사를 확인
	- `grep -i size`와 조합하여 사용하면 전체 슬롯 중 몇 개가 비어 있고, 몇 기가(GB) 메모리가 꽂혀 있는지 빠르게 파악가능.

---

## 4. 디스크 정보 확인하기

### **4.1 파티션 및 마운트 정보 (`df -h`)**

- ![](images/Pasted%20image%2020260127001414.png)
- 시스템에 마운트된 디스크의 용량과 사용량을 확인한다.
- **디스크 명칭의 의미:**
    - **sda/sdb:** SCSI, SATA, SAS 방식의 일반적인 하드 디스크
    - **hda/hdb:** 구형 IDE 방식의 디스크
    - **vda/vdb:** KVM, Xen 등 하이퍼바이저 기반의 가상 서버용 디스크

- `smartctl -a /dev/sda` 명령어로 디스크의 제조사와 용량을 확인가능
	- **RAID 환경:** 서버는 보통 RAID 컨트롤러를 사용하므로 `-d` 옵션(예: `cciss`, `megaraid`)을 사용해야지만 레이드 뒤에 숨겨진 물리 디스크의 시리얼 번호와 펌웨어 버전을 확인 가능하다.
- 위 예시, **클라우드:** EBS는 네트워크로 연결된 가상 저장소이므로 물리적인 S.M.A.R.T 지표가 존재하지 않음.
- 디스크 성능 측정을 위한 `iostat`
	- `df`는 용량만 보여주지만, 실제 디스크의 병목(Wait 타임)을 확인하려면 `sysstat` 패키지의 `iostat -x 1` 명령어를 통해 가능
	- ![](images/Pasted%20image%2020260127002507.png)

---

## 5. 네트워크 정보 확인하기

### **5.1 어댑터 정보 (`lspci`, `ethtool`)**

- **lspci:** 네트워크 카드의 정확한 모델명(예: Broadcom BCM5709)을 확인하여 호환되는 드라이버와 펌웨어를 찾는 데 사용
- **ethtool (기본):** 링크 연결 상태(`Link detected`), 지원 속도, 현재 설정된 속도(Speed)를 확인
    

### **5.2 네트워크 성능 최적화 옵션**

- **Ring Buffer (`ethtool -g`):** 네트워크 카드의 버퍼 공간
	- 패킷 유실을 방지하려면 `maximums` 값과 `current` 값을 동일하게 설정하는 것이 좋음
    
- **tcp-offload (`ethtool -k`):** MTU 이상의 크기를 가지는 패킷의 분할 처리를 CPU 대신 네트워크 카드가 직접 하게 하여 CPU 부하를 줄이는 기능(tcp-offload) 등을 확인
    
- **드라이버 정보 (`ethtool -i`):** 사용 중인 커널 모듈 드라이버의 이름과 버전을 확인
    