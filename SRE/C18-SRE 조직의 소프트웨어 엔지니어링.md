# Software Engineering in SRE

- Google의 소프트웨어 엔지니어링 중 많은 비중을 차지하는 제품이 무엇이냐하면 -> Gmail, Maps 같은 사용자 서비스라고 답할 것이다.
- 하지만 상당 부분은 사용자에게 드러나지 않은 SRE 조직에서 개발한 소프트웨어이다.
- 롤아웃 배포 메커니즘, 모니터링, 동적 서버 구성 기반 개발 환경
- 하나의 독립된 소프츠웨어 엔지니어링 프로젝트
- 소프트웨어 개발자와 동일한 마음가짐으로 로드맵에 기초하여 업무 수행
---

## Why Is Software Engineering Within SRE Important?

Google의 대규모 프로덕션 환경은 외부 도구로는 충족되지 않으며, SRE 내에서 자체적으로 소프트웨어를 개발할 필요성이 존재한다.
- **SRE가 소프트웨어 개발에 적합한 이유**
	- Google의 프로덕션 환경에 대한 폭넓고 깊은 지식 덕분에 확장성이나 장애 발생시 대응 및 다른 도구와의 호환성을 고려한 소프트웨어 설계 가능.
	- 사용자(다른 SRE들) 와의 직접적이고 신속한 피드백을 얻을 수 있다.
	- 내부 사용자 대상으로 빠른 출시와 반복 작업 가능, 초기 UI나 소프트웨어 문제에 대해 더 관대하다
	- SRE 가이드 원리: "팀의 규모는 서비스의 성장률과 직접적으로 비례하면 안된다."  
	  ->  폭발적으로 성장하는 서비스에도 불구하고 SRE 조직 규모를 선형적으로 유지하기 위해서는   
	  -> 자동화와 효율성 향상을 위해 지속적인 소프트웨어 개발 필요  
	- 프로덕션 시스템 운영 경험을 가진 엔지니어가 개발하면 가동 시간과 지연 목표를 효과적으로 달성 가능하다.
	- SRE 직업 만족도를 높여준다 - 코딩 스킬 유지
	- 소프트웨어 개발 경험을 가진 엔지니어 + 시스템 엔지니어링 경험을 가진 엔지니어 혼합한 팀을 유지

---

## Auxon Case Study: Project Background and Problem Space

Auxon는 SRE가 구글 프로덕션 환경에서 실행되는 서비스의 수용량 계획(capacity planning)을 자동화하기 위해 만든 소프트웨어이다.
### Traditional Capacity Planning

1. 수요 예측의 수집  
   - 자원이 얼마나 필요한가? 언제, 어디에 필요한가?
   - 현재 가용한 최선의 데이터를 확보해야 미래에 대한 계획을 수립 할 수 있다.
   - 몇 분기에서 몇 년에 이르는 데이터 기반으로 자료 수집

2. 빌드 및 할당 계획의 수립
   - 예측된 수요를 충족하기 위해 자원을 어디에 얼마나 배치해야 하는가

3.  리뷰 및 계획의 승인 
   - 예측된 수요는 적절한가?
   - 예산 범위를 초과 하지 않으며 기술적 고려 사항이 모두 고려됐는가.

4. 배포 및 자원 설정  
   - 자원이 도착하면 어떤 서비스가 이를 사용할지, 자원을 어떻게 적절하게 활용할 것인가.

-> 계속해서 게획이 수정될 수 밖에 없다.
계획 변경이 연쇄적으로 영향을 미쳐 시간과 노력을 소모하여 수작업이 진행된다.

#### Brittle by nature 본질적으로 불안하다.

- 서비스 효율성 저하로 더 많은 자원을 필요로 하는 경우
- 예상보다 높은 수요 증가
- 자원 배송 지연 등의 변화
- 제품의 성능 목표가 변경되어 서비스의 배포의 양 변경

작은 변화에도 확인을 위해 전체 할당 계획을 재점검 해야한다.
계획 변경이 연쇄적으로 영향을 미쳐 시간과 노력을 소모하게 한다.

#### Laborious and imprecise 노동집약적이며 모호하다

- 수요 예측 데이터 수집이 느리고 오류를 범하기 쉽다.
- 자원 할당이 수작업으로 이루어져 복잡하고 번거롭다.
- 도구(예: 스프레드시트)의 신뢰성과 확장성이 부족하며 제한적인 기능만 제공한다.

즉, 서비스 담당자들이 일련의 수용량 요청을 계속 감당하려고 하면 할 수록 불확실한 요소들을 계속해서 증가한다.
(비유)
- 상자 채우기 문제 (bin packing problem)은 인간이 직접 계산하기에는 무척 어려운 NP-hard 문제이다.
- 수작업으로 처리하기 어렵다.
- 서비스 요구사항( X 코어 Y 클러스터) 의 유연성이 부족하다. 결국 사람이 하기에는 엄청난 노력이 필요하다
### Our Solution: Intent-Based Capacity Planning 의도 기반 수용량 계획

- 의도기반 수용량 계획 접근법을 활용
- 기본적인 전제: 의존성과 서비스의 요구 사항(의도)를 프로그래밍 방식으로 인코딩하여 할당 계획 자동 생성하는 것.
- 수요, 공급, 서비스 요구 사항 변경에 따라 변경된 매개변수를 바탕으로 새로운 계획 자동 생성된다
- 결국 상자 채우기 문제를 컴퓨터에 위임함으로써, 인력 낭비 감소, 최적화된 자원 배치를 통해 비용 절감
- 서비스 담당자의 수작업을 줄이고 고급 우선순위(SLO, 서비스 의존성 등)에 집중 가능해졌다.

## Intent-Based Capacity Planning

intent 의도 란?  
서비스 담당자가 자신들의 서비스를 운영하고자 하는 의도를 의미한다.

의도 기반 수용량 계획를 도출하기 위해 여러 단계의 **추상화**가 필요하다
    
1. 구체적 자원 요청: "Foo 서비스를 위해 클러스터 X, Y, Z에 50 코어 필요합니다."
2. 약간의 자유도 포함: "Foo 서비스를 위해 YYY 지역의 3개 클러스터에 50코어 필요합니다."
3. 유연성 도입: "Foo 서비스에 대한 각 지역별 수요를 충당하기를 원하며 N+2의 다중화를 원합니다."
   -> 자유도 매우 증가
4. 추상적 요구 및 더 유연적: "Foo 서비스에 99.999% 가용성 지원하고 싶습니다."
   -> N+2 다중화만으로 서비스 최적화 못할 수도 있으므로 다른 배포 계획 세울 수 있다.

- 결국 의도 기반 수용량 계획을 위해서는 어느 정도 수준의 의도가 반영되어야 할것인가?
- Google의 경험에 따르면 3단계 추상화를 제공할때 가장 큰성과를 냄
- 정교한 서비스는 4단계

### Precursors to Intent 의도를 파악하기 위한 선행 작업

- **의존성(Dependencies)**:
    - 의존성은 서비스의 위치를 결정하는 데 큰 영향을 미친다
    - ex) 서비스 Foo가 인프라 서비스 Bar에 의존하며, Bar는 30ms 이내에 있어야 함
    - 의존성이 중첩된 경우(예: Bar가 Baz와 Qux에 의존) 이를 모두 고려해야 함

- **성능 지표(Performance Metrics)**:
	- 의존성만이 아닌 조금더 자세한 정보가 필요한데 이는 성능 지표다 - 의존성과 성능지표의 연관성
    - ex) 서비스 Foo가 사용자 쿼리 N을 처리하려면 몇 개의 컴퓨팅 자원이 필요한가?
    - Foo 서비스에 N개의 요청이 전달되면 Bar 서비스는 몇 Mbps의 데이터를 서비스해야 할까?
    - 성능지표 확보를 위해 모니터링 필요

- **우선순위 결정 (Prioritization)**:
    - 자원 제한 상황에서 요구사항 간의 trade-offs를 투명하게 설정가능
    - 예: Foo의 N+2 다중화는 Bar의 N+1 다중화보다 더 중요시

---
### Introduction to Auxon



![600](images/sre.jpg)



---

### Requirements and Implementation: Successes and Lessons Learned

#### Approximation

---

### Raising Awareness and Driving Adoption 인식의 제고 및 도입의 촉진

#### Set expectations 기대치 설정하기

#### Identify appropriate customers 적절한 사용자층을 정의하기

#### Customer service

#### Designing at the right level 적절한 수준의 디자인


---

### Team Dynamics 팀의 원동력

---

## Fostering Software Engineering in SRE 
SRE 조직에서 소프트웨어 엔지니어링을 육성하는 방법

### Successfully Building a Software Engineering Culture in SRE: Staffing and Development Time
SRE 조직에 소프트웨어 엔지니어링 문화를 성공적으로 정착시키기: 인력 수급과 개발 시간


### Getting There 목표 이루기

## Conclusions